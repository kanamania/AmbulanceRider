@using AmbulanceRider.Services
@using Microsoft.AspNetCore.Components.Authorization
@inject AuthService AuthService
@inject NavigationManager NavigationManager

@if (!IsLoginPage())
{
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
            <a class="navbar-brand d-flex align-items-center" href="">
                <img src="ge-logo.png" alt="Global Express Logo" class="me-2" style="height: 32px;" />
            </a>
            <button class="navbar-toggler" type="button" @onclick="ToggleNavmenu">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="@NavMenuCssClass navbar-collapse">
                <AuthorizeView Roles="Admin,Dispatcher">
                    <Authorized>
                        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                            <li class="nav-item">
                                <NavLink class="nav-link" href="" Match="NavLinkMatch.All">
                                    <i class="bi bi-house-door me-1"></i> Dashboard
                                </NavLink>
                            </li>

                            <li class="nav-item">
                                <NavLink class="nav-link" href="users" Match="NavLinkMatch.Prefix">
                                    <i class="bi bi-people me-1"></i> Users
                                </NavLink>
                            </li>
                            <li class="nav-item">
                                <NavLink class="nav-link" href="companies" Match="NavLinkMatch.Prefix">
                                    <i class="bi bi-buildings me-1"></i> Companies
                                </NavLink>
                            </li>
                            <li class="nav-item">
                                <NavLink class="nav-link" href="vehicles" Match="NavLinkMatch.Prefix">
                                    <i class="bi bi-truck me-1"></i> Vehicles
                                </NavLink>
                            </li>
                            <li class="nav-item">
                                <NavLink class="nav-link" href="locations" Match="NavLinkMatch.Prefix">
                                    <i class="bi bi-geo-alt me-1"></i> Locations
                                </NavLink>
                            </li>
                            <li class="nav-item">
                                <NavLink class="nav-link" href="trips" Match="NavLinkMatch.Prefix">
                                    <i class="bi bi-calendar-check me-1"></i> Trips
                                </NavLink>
                            </li>
                            <li class="nav-item">
                                <NavLink class="nav-link" href="telemetry" Match="NavLinkMatch.Prefix">
                                    <i class="bi bi-graph-up me-1"></i> Telemetry
                                </NavLink>
                            </li>
                            <li class="nav-item">
                                <NavLink class="nav-link" href="invoices" Match="NavLinkMatch.Prefix">
                                    <i class="bi bi-receipt me-1"></i> Invoices
                                </NavLink>
                            </li>
                            <li class="nav-item">
                                <NavLink class="nav-link" href="pricing" Match="NavLinkMatch.Prefix">
                                    <i class="bi bi-currency-dollar me-1"></i> Pricing
                                </NavLink>
                            </li>
                        </ul>
                    </Authorized>
                </AuthorizeView>
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <AuthorizeView>
                            <Authorized>
                                <a href="logout" class="nav-link" @onclick="Logout">
                                    <i class="bi bi-box-arrow-right me-1"></i> Logout
                                </a>
                            </Authorized>
                            <NotAuthorized>
                                <NavLink href="login" class="nav-link">
                                    <i class="bi bi-box-arrow-in-right me-1"></i> Login
                                </NavLink>
                            </NotAuthorized>
                        </AuthorizeView>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
}

@code {
    private bool _collapseNavMenu = true;

    private string? NavMenuCssClass => _collapseNavMenu ? "collapse" : null;

    private void ToggleNavmenu()
    {
        _collapseNavMenu = !_collapseNavMenu;
    }

    private bool IsLoginPage()
    {
        var uri = NavigationManager.ToAbsoluteUri(NavigationManager.Uri);
        return uri.AbsolutePath.Equals("/login", StringComparison.OrdinalIgnoreCase);
    }

    private async Task Logout()
    {
        await AuthService.LogoutAsync();
        NavigationManager.NavigateTo("/", true);
    }

}