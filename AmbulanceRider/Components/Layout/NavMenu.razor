@using AmbulanceRider.Services
@using Microsoft.AspNetCore.Components.Authorization
@inject AuthService AuthService
@inject NavigationManager NavigationManager

@if (!IsLoginPage())
{
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
            <a class="navbar-brand" href="">
                <i class="bi bi-ambulance me-2"></i>Ambulance Rider
            </a>
            <button class="navbar-toggler" type="button" @onclick="ToggleNavmenu">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="@NavMenuCssClass navbar-collapse">
                <AuthorizeView Roles="Admin,Dispatcher">
                    <Authorized>
                        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                            <li class="nav-item">
                                <NavLink class="nav-link" href="" Match="NavLinkMatch.All">
                                    <i class="bi bi-house-door me-1"></i> Dashboard
                                </NavLink>
                            </li>

                            <li class="nav-item dropdown">
                                <NavLink class="dropdown-item" href="users">
                                    <i class="bi bi-people me-1"></i> Users
                                </NavLink>
                            </li>
                            <li class="nav-item dropdown">
                                <NavLink class="dropdown-item" href="vehicles">
                                    <i class="bi bi-truck me-1"></i> Vehicles
                                </NavLink>
                            </li>
                            <li class="nav-item dropdown">
                                <NavLink class="dropdown-item" href="locations">
                                    <i class="bi bi-geo-alt me-1"></i> Locations
                                </NavLink>
                            </li>
                            <li class="nav-item dropdown">
                                <NavLink class="dropdown-item" href="trips">
                                    <i class="bi bi-calendar-check me-1"></i> Trips
                                </NavLink>
                            </li>
                            <li class="nav-item dropdown">
                                <NavLink class="dropdown-item" href="triptypes">
                                    <i class="bi bi-tags me-1"></i> Trip Types
                                </NavLink>
                            </li>
                        </ul>
                    </Authorized>
                </AuthorizeView>
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <AuthorizeView>
                            <Authorized>
                                <a href="logout" class="nav-link" @onclick="Logout">
                                    <i class="bi bi-box-arrow-right me-1"></i> Logout
                                </a>
                            </Authorized>
                            <NotAuthorized>
                                <NavLink href="login" class="nav-link">
                                    <i class="bi bi-box-arrow-in-right me-1"></i> Login
                                </NavLink>
                            </NotAuthorized>
                        </AuthorizeView>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
}

@code {
    private bool _collapseNavMenu = true;

    private string? NavMenuCssClass => _collapseNavMenu ? "collapse" : null;

    private void ToggleNavmenu()
    {
        _collapseNavMenu = !_collapseNavMenu;
    }

    private bool IsLoginPage()
    {
        var uri = NavigationManager.ToAbsoluteUri(NavigationManager.Uri);
        return uri.AbsolutePath.Equals("/login", StringComparison.OrdinalIgnoreCase);
    }

    private async Task Logout()
    {
        await AuthService.LogoutAsync();
        NavigationManager.NavigateTo("/", true);
    }

}